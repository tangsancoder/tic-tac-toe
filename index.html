<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cute Tic Tac Toe - Full App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff69b4;
            --secondary-color: #ff1493;
            --accent-color: #ffc0cb;
            --background-color: #fff5f7;
            --text-color: #ff69b4;
            --board-color: #ffe4e9;
            --cell-color: white;
            --shadow-color: rgba(255, 105, 180, 0.2);
        }

        .theme-pink {
            --primary-color: #ff69b4;
            --secondary-color: #ff1493;
            --accent-color: #ffc0cb;
            --background-color: #fff5f7;
            --text-color: #ff69b4;
            --board-color: #ffe4e9;
            --cell-color: white;
            --shadow-color: rgba(255, 105, 180, 0.2);
        }

        .theme-blue {
            --primary-color: #4a90e2;
            --secondary-color: #2c6cb0;
            --accent-color: #a3d5ff;
            --background-color: #f0f8ff;
            --text-color: #4a90e2;
            --board-color: #e6f2ff;
            --cell-color: white;
            --shadow-color: rgba(74, 144, 226, 0.2);
        }

        .theme-purple {
            --primary-color: #9b59b6;
            --secondary-color: #8e44ad;
            --accent-color: #d7bde2;
            --background-color: #f9f0ff;
            --text-color: #9b59b6;
            --board-color: #f0e6ff;
            --cell-color: white;
            --shadow-color: rgba(155, 89, 182, 0.2);
        }

        .theme-green {
            --primary-color: #2ecc71;
            --secondary-color: #27ae60;
            --accent-color: #a3e4d7;
            --background-color: #f0fff4;
            --text-color: #2ecc71;
            --board-color: #e6ffed;
            --cell-color: white;
            --shadow-color: rgba(46, 204, 113, 0.2);
        }

        .theme-dark {
            --primary-color: #ff6bcb;
            --secondary-color: #ff2da6;
            --accent-color: #333;
            --background-color: #1a1a1a;
            --text-color: #ff6bcb;
            --board-color: #2a2a2a;
            --cell-color: #333;
            --shadow-color: rgba(255, 107, 203, 0.2);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--background-color);
            background-image: radial-gradient(var(--accent-color) 2px, transparent 2px);
            background-size: 30px 30px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.5s ease;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3.5rem;
            color: var(--primary-color);
            text-shadow: 3px 3px 0 var(--accent-color);
            margin-bottom: 10px;
            letter-spacing: 1px;
            transition: all 0.5s ease;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-weight: 700;
            transition: all 0.5s ease;
        }

        .app-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 0 var(--secondary-color);
        }

        .control-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--secondary-color);
        }

        .theme-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .theme-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.active {
            border-color: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .theme-pink-btn { background: linear-gradient(45deg, #ff69b4, #ff1493); }
        .theme-blue-btn { background: linear-gradient(45deg, #4a90e2, #2c6cb0); }
        .theme-purple-btn { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .theme-green-btn { background: linear-gradient(45deg, #2ecc71, #27ae60); }
        .theme-dark-btn { background: linear-gradient(45deg, #1a1a1a, #333); }

        .setup-panel {
            background-color: white;
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px var(--shadow-color);
            border: 8px solid var(--accent-color);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.5s ease;
        }

        .setup-panel h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
            transition: all 0.5s ease;
        }

        .player-setup {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
        }

        .player-input {
            flex: 1;
            min-width: 250px;
            background-color: #fff0f5;
            padding: 20px;
            border-radius: 20px;
            text-align: left;
            transition: all 0.5s ease;
        }

        .theme-blue .player-input { background-color: #e6f2ff; }
        .theme-purple .player-input { background-color: #f0e6ff; }
        .theme-green .player-input { background-color: #e6ffed; }
        .theme-dark .player-input { background-color: #2a2a2a; }

        .player-input h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.5s ease;
        }

        .player-input label {
            display: block;
            margin-bottom: 8px;
            color: var(--secondary-color);
            font-weight: 700;
            transition: all 0.5s ease;
        }

        .player-input input, .player-input select {
            width: 100%;
            padding: 12px;
            border-radius: 15px;
            border: 3px solid var(--accent-color);
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            outline: none;
            transition: all 0.3s ease;
            background-color: white;
        }

        .player-input input:focus, .player-input select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.3);
        }

        .avatar-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            background-color: white;
        }

        .avatar-option:hover {
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border-color: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .difficulty-section {
            background-color: #fff0f5;
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 25px;
            transition: all 0.5s ease;
        }

        .theme-blue .difficulty-section { background-color: #e6f2ff; }
        .theme-purple .difficulty-section { background-color: #f0e6ff; }
        .theme-green .difficulty-section { background-color: #e6ffed; }
        .theme-dark .difficulty-section { background-color: #2a2a2a; }

        .difficulty-section h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            transition: all 0.5s ease;
        }

        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            border: 3px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            background-color: white;
            color: var(--primary-color);
            box-shadow: 0 5px 0 var(--accent-color);
        }

        .difficulty-btn:hover {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--accent-color);
        }

        .difficulty-btn.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 0 var(--secondary-color), 0 0 20px var(--primary-color);
        }

        .difficulty-btn i {
            font-size: 1.5rem;
        }

        .difficulty-btn .difficulty-name {
            font-size: 1.1rem;
        }

        .difficulty-btn .difficulty-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .start-game-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.3rem;
            font-weight: 900;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            box-shadow: 0 8px 0 var(--secondary-color);
            margin-top: 10px;
        }

        .start-game-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(5px);
            box-shadow: 0 3px 0 var(--secondary-color);
        }

        .game-wrapper {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            width: 350px;
            height: 350px;
            background-color: var(--board-color);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 10px 25px var(--shadow-color);
            border: 8px solid var(--accent-color);
            transition: all 0.5s ease;
        }

        .cell {
            background-color: var(--cell-color);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--shadow-color);
            position: relative;
            overflow: hidden;
        }

        .cell:hover {
            transform: scale(1.05);
            background-color: var(--accent-color);
            box-shadow: 0 8px 20px var(--shadow-color);
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .game-info {
            background-color: white;
            padding: 25px;
            border-radius: 25px;
            width: 400px;
            box-shadow: 0 10px 25px var(--shadow-color);
            border: 8px solid var(--accent-color);
            transition: all 0.5s ease;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 20px;
            background-color: #fff0f5;
            transition: all 0.5s ease;
        }

        .theme-blue .player-info { background-color: #e6f2ff; }
        .theme-purple .player-info { background-color: #f0e6ff; }
        .theme-green .player-info { background-color: #e6ffed; }
        .theme-dark .player-info { background-color: #2a2a2a; }

        .player-avatar {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 5px solid var(--accent-color);
            transition: all 0.5s ease;
        }

        .player-details {
            flex: 1;
            margin-left: 20px;
            text-align: left;
        }

        .player-name {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--secondary-color);
            margin-bottom: 5px;
            transition: all 0.5s ease;
        }

        .player-type {
            font-size: 1rem;
            color: var(--primary-color);
            padding: 3px 10px;
            background-color: var(--accent-color);
            border-radius: 10px;
            display: inline-block;
            margin-top: 5px;
        }

        .player-turn {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 20px;
            background-color: #fff0f5;
            color: var(--secondary-color);
            transition: all 0.3s ease;
        }

        .theme-blue .player-turn { background-color: #e6f2ff; }
        .theme-purple .player-turn { background-color: #f0e6ff; }
        .theme-green .player-turn { background-color: #e6ffed; }
        .theme-dark .player-turn { background-color: #2a2a2a; }

        .player-turn.active {
            background-color: var(--primary-color);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 var(--shadow-color); }
            70% { box-shadow: 0 0 0 15px transparent; }
            100% { box-shadow: 0 0 0 0 transparent; }
        }

        .scores {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
        }

        .score-box {
            background-color: #fff0f5;
            padding: 15px;
            border-radius: 20px;
            width: 45%;
            transition: all 0.5s ease;
        }

        .theme-blue .score-box { background-color: #e6f2ff; }
        .theme-purple .score-box { background-color: #f0e6ff; }
        .theme-green .score-box { background-color: #e6ffed; }
        .theme-dark .score-box { background-color: #2a2a2a; }

        .score-title {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--primary-color);
            transition: all 0.5s ease;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--secondary-color);
            transition: all 0.5s ease;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        button {
            border: none;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: 900;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .reset-btn {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 5px 0 var(--secondary-color);
        }

        .reset-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--secondary-color);
        }

        .new-game-btn {
            background-color: var(--accent-color);
            color: var(--secondary-color);
            box-shadow: 0 5px 0 var(--primary-color);
        }

        .new-game-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--primary-color);
        }

        .winning-cell {
            animation: pulse 1.5s infinite;
            background-color: var(--accent-color);
        }

        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 35px var(--shadow-color);
            border: 8px solid var(--accent-color);
            z-index: 100;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s ease;
            max-width: 400px;
            width: 90%;
            transition: all 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .message h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
            font-family: 'Pacifico', cursive;
            transition: all 0.5s ease;
        }

        .message p {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            transition: all 0.5s ease;
        }

        .message-winner {
            font-size: 3rem;
            margin: 15px 0;
        }

        .close-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 900;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 182, 193, 0.7);
            z-index: 99;
            display: none;
        }

        .theme-blue .overlay { background-color: rgba(163, 213, 255, 0.7); }
        .theme-purple .overlay { background-color: rgba(215, 189, 226, 0.7); }
        .theme-green .overlay { background-color: rgba(163, 228, 215, 0.7); }
        .theme-dark .overlay { background-color: rgba(51, 51, 51, 0.7); }

        .decoration {
            position: absolute;
            font-size: 2rem;
            opacity: 0.7;
            z-index: -1;
        }

        footer {
            margin-top: 20px;
            color: var(--primary-color);
            font-size: 1rem;
            text-align: center;
            padding: 20px;
            max-width: 800px;
            transition: all 0.5s ease;
        }

        .install-instructions {
            background-color: white;
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            border: 5px solid var(--accent-color);
            text-align: left;
            transition: all 0.5s ease;
        }

        .install-instructions h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            transition: all 0.5s ease;
        }

        .install-instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .install-instructions li {
            margin-bottom: 10px;
            color: var(--primary-color);
            transition: all 0.5s ease;
        }

        @media (max-width: 768px) {
            .game-wrapper {
                flex-direction: column;
                align-items: center;
            }
            
            .game-info {
                width: 350px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .player-setup {
                flex-direction: column;
            }
            
            .app-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .difficulty-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .difficulty-btn {
                width: 100%;
                max-width: 250px;
            }
        }

        /* Install Button */
        #installButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 5px 15px var(--shadow-color);
            display: none;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        #installButton:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="theme-pink">
    <button id="installButton" style="display: none;">
        <i class="fas fa-download"></i> Install App
    </button>

    <div class="overlay" id="overlay"></div>
    
    <div class="container">
        <h1>Cute Tic Tac Toe</h1>
        <div class="subtitle">Play with friends or against AI in multiple themes!</div>
        
        <div class="app-controls">
            <button class="control-btn" id="saveGameBtn">
                <i class="fas fa-save"></i> Save Game
            </button>
            <button class="control-btn" id="loadGameBtn">
                <i class="fas fa-folder-open"></i> Load Game
            </button>
            <button class="control-btn" id="soundToggle">
                <i class="fas fa-volume-up"></i> Sound On
            </button>
        </div>
        
        <div class="theme-selector">
            <div class="theme-option theme-pink-btn active" data-theme="pink"></div>
            <div class="theme-option theme-blue-btn" data-theme="blue"></div>
            <div class="theme-option theme-purple-btn" data-theme="purple"></div>
            <div class="theme-option theme-green-btn" data-theme="green"></div>
            <div class="theme-option theme-dark-btn" data-theme="dark"></div>
        </div>
        
        <!-- Player Setup Panel -->
        <div class="setup-panel" id="setupPanel">
            <h2>Customize Your Game</h2>
            
            <div class="player-setup">
                <div class="player-input">
                    <h3><i class="fas fa-user"></i> Player 1 (X)</h3>
                    
                    <label for="player1Name">Player Name:</label>
                    <input type="text" id="player1Name" placeholder="Enter Player 1 name" value="Player 1">
                    
                    <label for="player1Type">Player Type:</label>
                    <select id="player1Type">
                        <option value="human">Human</option>
                        <option value="robot">Robot (AI)</option>
                    </select>
                    
                    <label>Choose Avatar:</label>
                    <div class="avatar-selection" id="player1Avatars">
                        <!-- Avatars will be added by JavaScript -->
                    </div>
                </div>
                
                <div class="player-input">
                    <h3><i class="fas fa-user"></i> Player 2 (O)</h3>
                    
                    <label for="player2Name">Player Name:</label>
                    <input type="text" id="player2Name" placeholder="Enter Player 2 name" value="Player 2">
                    
                    <label for="player2Type">Player Type:</label>
                    <select id="player2Type">
                        <option value="human">Human</option>
                        <option value="robot">Robot (AI)</option>
                    </select>
                    
                    <label>Choose Avatar:</label>
                    <div class="avatar-selection" id="player2Avatars">
                        <!-- Avatars will be added by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Beautifully Designed Difficulty Section -->
            <div class="difficulty-section">
                <h3><i class="fas fa-robot"></i> AI Difficulty Level</h3>
                <div class="difficulty-buttons">
                    <div class="difficulty-btn" data-difficulty="easy">
                        <i class="fas fa-baby"></i>
                        <div class="difficulty-name">Easy</div>
                        <div class="difficulty-desc">For beginners</div>
                    </div>
                    <div class="difficulty-btn selected" data-difficulty="medium">
                        <i class="fas fa-smile"></i>
                        <div class="difficulty-name">Medium</div>
                        <div class="difficulty-desc">Balanced challenge</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="hard">
                        <i class="fas fa-crown"></i>
                        <div class="difficulty-name">Hard</div>
                        <div class="difficulty-desc">Expert level</div>
                    </div>
                </div>
            </div>
            
            <button class="start-game-btn" id="startGameBtn">
                <i class="fas fa-play-circle"></i> Start Game!
            </button>
        </div>
        
        <!-- Game Area (hidden initially) -->
        <div class="game-wrapper" id="gameWrapper">
            <div class="game-board" id="gameBoard">
                <!-- Cells will be generated by JavaScript -->
            </div>
            
            <div class="game-info">
                <div class="player-info" id="player1Info">
                    <div class="player-avatar" id="player1AvatarDisplay">‚ùÄ</div>
                    <div class="player-details">
                        <div class="player-name" id="player1NameDisplay">Player 1</div>
                        <div class="player-type" id="player1TypeDisplay">Human</div>
                    </div>
                </div>
                
                <div class="player-turn" id="playerTurn">
                    <span id="currentPlayerName">Player 1</span>'s Turn
                </div>
                
                <div class="player-info" id="player2Info">
                    <div class="player-avatar" id="player2AvatarDisplay">üå∏</div>
                    <div class="player-details">
                        <div class="player-name" id="player2NameDisplay">Player 2</div>
                        <div class="player-type" id="player2TypeDisplay">Human</div>
                    </div>
                </div>
                
                <div class="scores">
                    <div class="score-box">
                        <div class="score-title" id="player1ScoreLabel">Player 1</div>
                        <div class="score-value" id="scoreX">0</div>
                    </div>
                    
                    <div class="score-box">
                        <div class="score-title" id="player2ScoreLabel">Player 2</div>
                        <div class="score-value" id="scoreO">0</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="reset-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset Round
                    </button>
                    <button class="new-game-btn" id="newGameBtn">
                        <i class="fas fa-users"></i> Change Players
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="install-instructions" id="installInstructions">
                <h3>How to Install This App:</h3>
                <ul>
                    <li><strong>On iPhone/iPad:</strong> Tap the Share button <i class="fas fa-share-square"></i> and select "Add to Home Screen"</li>
                    <li><strong>On Android:</strong> Tap the menu button (‚ãÆ) and select "Install app" or "Add to Home Screen"</li>
                    <li><strong>On Windows/Mac:</strong> Use Chrome/Edge and click "Install" button that appears at the top right</li>
                </ul>
                <p>Once installed, the app will work offline and feel like a native app!</p>
            </div>
            <p>Made with ‚ù§Ô∏è - A fully installable PWA with AI opponent!</p>
        </footer>
    </div>
    
    <div class="message" id="message">
        <h2 id="messageTitle">Game Over!</h2>
        <div class="message-winner" id="winnerAvatar"></div>
        <p id="messageText"></p>
        <button class="close-btn" id="closeMessage">Continue Playing</button>
    </div>

    <script>
        // Game state variables
        let currentPlayer = 'X';
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let gameActive = true;
        let scores = { X: 0, O: 0 };
        let soundEnabled = true;
        let deferredPrompt;
        
        // Player data
        let playerData = {
            X: {
                name: "Player 1",
                avatar: "‚ùÄ",
                type: "human" // human or robot
            },
            O: {
                name: "Player 2", 
                avatar: "üå∏",
                type: "human"
            }
        };
        
        // Game settings
        let difficulty = "medium";
        
        // Available avatars
        const availableAvatars = [
            "‚ùÄ", "üå∏", "üíÆ", "üå∑", "üåπ", "üå∫", "üåª", "üåº",
            "üíê", "ü¶Ñ", "üêá", "üê∞", "üê∑", "üê∂", "üê±", "üêØ",
            "üíó", "üíñ", "üíï", "üíû", "üíì", "üíù", "üéÄ", "üéÅ",
            "üç¶", "üçß", "üç®", "üç©", "üç™", "üéÇ", "üç¨", "üç≠"
        ];
        
        // Winning combinations
        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
            [0, 4, 8], [2, 4, 6]             // diagonals
        ];
        
        // DOM Elements
        const setupPanel = document.getElementById('setupPanel');
        const gameWrapper = document.getElementById('gameWrapper');
        const gameBoardElement = document.getElementById('gameBoard');
        const playerTurnElement = document.getElementById('playerTurn');
        const currentPlayerNameElement = document.getElementById('currentPlayerName');
        const scoreXElement = document.getElementById('scoreX');
        const scoreOElement = document.getElementById('scoreO');
        const resetBtn = document.getElementById('resetBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const messageElement = document.getElementById('message');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const winnerAvatarElement = document.getElementById('winnerAvatar');
        const closeMessageBtn = document.getElementById('closeMessage');
        const overlay = document.getElementById('overlay');
        const installButton = document.getElementById('installButton');
        const installInstructions = document.getElementById('installInstructions');
        
        // Player setup elements
        const player1NameInput = document.getElementById('player1Name');
        const player2NameInput = document.getElementById('player2Name');
        const player1TypeSelect = document.getElementById('player1Type');
        const player2TypeSelect = document.getElementById('player2Type');
        const player1AvatarsContainer = document.getElementById('player1Avatars');
        const player2AvatarsContainer = document.getElementById('player2Avatars');
        const startGameBtn = document.getElementById('startGameBtn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        
        // App control elements
        const saveGameBtn = document.getElementById('saveGameBtn');
        const loadGameBtn = document.getElementById('loadGameBtn');
        const soundToggle = document.getElementById('soundToggle');
        const themeOptions = document.querySelectorAll('.theme-option');
        
        // Player display elements
        const player1NameDisplay = document.getElementById('player1NameDisplay');
        const player2NameDisplay = document.getElementById('player2NameDisplay');
        const player1AvatarDisplay = document.getElementById('player1AvatarDisplay');
        const player2AvatarDisplay = document.getElementById('player2AvatarDisplay');
        const player1TypeDisplay = document.getElementById('player1TypeDisplay');
        const player2TypeDisplay = document.getElementById('player2TypeDisplay');
        const player1ScoreLabel = document.getElementById('player1ScoreLabel');
        const player2ScoreLabel = document.getElementById('player2ScoreLabel');
        
        // Initialize avatar selection
        function initializeAvatarSelection() {
            // Clear containers
            player1AvatarsContainer.innerHTML = '';
            player2AvatarsContainer.innerHTML = '';
            
            // Create avatar options for player 1
            availableAvatars.forEach((avatar, index) => {
                const avatarOption = document.createElement('div');
                avatarOption.classList.add('avatar-option');
                avatarOption.textContent = avatar;
                avatarOption.dataset.avatar = avatar;
                
                // Select default avatars
                if (index === 0) {
                    avatarOption.classList.add('selected');
                    playerData.X.avatar = avatar;
                }
                
                avatarOption.addEventListener('click', () => {
                    // Remove selected class from all avatars
                    document.querySelectorAll('#player1Avatars .avatar-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked avatar
                    avatarOption.classList.add('selected');
                    
                    // Update player data
                    playerData.X.avatar = avatar;
                });
                
                player1AvatarsContainer.appendChild(avatarOption);
            });
            
            // Create avatar options for player 2
            availableAvatars.forEach((avatar, index) => {
                const avatarOption = document.createElement('div');
                avatarOption.classList.add('avatar-option');
                avatarOption.textContent = avatar;
                avatarOption.dataset.avatar = avatar;
                
                // Select default avatars (different from player 1)
                if (index === 1) {
                    avatarOption.classList.add('selected');
                    playerData.O.avatar = avatar;
                }
                
                avatarOption.addEventListener('click', () => {
                    // Remove selected class from all avatars
                    document.querySelectorAll('#player2Avatars .avatar-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked avatar
                    avatarOption.classList.add('selected');
                    
                    // Update player data
                    playerData.O.avatar = avatar;
                });
                
                player2AvatarsContainer.appendChild(avatarOption);
            });
        }
        
        // Change theme
        function changeTheme(themeName) {
            // Remove all theme classes
            document.body.classList.remove('theme-pink', 'theme-blue', 'theme-purple', 'theme-green', 'theme-dark');
            
            // Add selected theme class
            document.body.classList.add(`theme-${themeName}`);
            
            // Update active theme button
            themeOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === themeName) {
                    option.classList.add('active');
                }
            });
            
            // Save theme preference
            localStorage.setItem('ticTacToeTheme', themeName);
        }
        
        // Handle difficulty selection
        function selectDifficulty(difficultyLevel) {
            difficulty = difficultyLevel;
            
            // Update UI
            difficultyButtons.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.difficulty === difficultyLevel) {
                    btn.classList.add('selected');
                }
            });
            
            // Save difficulty preference
            localStorage.setItem('ticTacToeDifficulty', difficultyLevel);
        }
        
        // AI Move Logic
        function makeAIMove() {
            if (!gameActive || playerData[currentPlayer].type !== 'robot') return;
            
            // Add delay to make AI seem like it's thinking
            setTimeout(() => {
                let moveIndex = -1;
                
                // Get available moves
                const availableMoves = gameBoard
                    .map((cell, index) => cell === '' ? index : null)
                    .filter(index => index !== null);
                
                if (availableMoves.length === 0) return;
                
                // Strategy based on difficulty
                if (difficulty === 'easy') {
                    // Easy: Random move
                    moveIndex = availableMoves[Math.floor(Math.random() * availableMoves.length)];
                } else if (difficulty === 'medium') {
                    // Medium: Try to win or block, otherwise random
                    moveIndex = findWinningMove(currentPlayer) || 
                               findWinningMove(currentPlayer === 'X' ? 'O' : 'X') || 
                               availableMoves[Math.floor(Math.random() * availableMoves.length)];
                } else if (difficulty === 'hard') {
                    // Hard: Use minimax algorithm for optimal play
                    moveIndex = getBestMove();
                }
                
                // Make the move
                if (moveIndex !== -1 && gameBoard[moveIndex] === '') {
                    gameBoard[moveIndex] = currentPlayer;
                    
                    // Update UI
                    const cellElement = document.querySelector(`.cell[data-index="${moveIndex}"]`);
                    cellElement.textContent = playerData[currentPlayer].avatar;
                    cellElement.style.color = currentPlayer === 'X' ? 
                        (document.body.classList.contains('theme-dark') ? '#ff6bcb' : '#ff69b4') : 
                        (document.body.classList.contains('theme-dark') ? '#ff2da6' : '#ff1493');
                    cellElement.style.animation = 'popIn 0.3s ease-out';
                    
                    // Play sound if enabled
                    if (soundEnabled) {
                        playSound('click');
                    }
                    
                    // Check game result
                    checkGameResult();
                }
            }, difficulty === 'easy' ? 300 : difficulty === 'medium' ? 600 : 800);
        }
        
        // Find winning move for a player
        function findWinningMove(player) {
            for (let condition of winningConditions) {
                const [a, b, c] = condition;
                const board = gameBoard;
                
                // Check if player can win with this move
                if (board[a] === player && board[b] === player && board[c] === '') return c;
                if (board[a] === player && board[c] === player && board[b] === '') return b;
                if (board[b] === player && board[c] === player && board[a] === '') return a;
            }
            return null;
        }
        
        // Minimax algorithm for hard difficulty
        function getBestMove() {
            // Simple implementation for hard difficulty
            // First, check if AI can win
            const winMove = findWinningMove(currentPlayer);
            if (winMove !== null) return winMove;
            
            // Then, check if need to block opponent
            const blockMove = findWinningMove(currentPlayer === 'X' ? 'O' : 'X');
            if (blockMove !== null) return blockMove;
            
            // Take center if available
            if (gameBoard[4] === '') return 4;
            
            // Take corners if available
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(index => gameBoard[index] === '');
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }
            
            // Take any available side
            const sides = [1, 3, 5, 7];
            const availableSides = sides.filter(index => gameBoard[index] === '');
            if (availableSides.length > 0) {
                return availableSides[Math.floor(Math.random() * availableSides.length)];
            }
            
            // Fallback to random move
            const availableMoves = gameBoard
                .map((cell, index) => cell === '' ? index : null)
                .filter(index => index !== null);
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }
        
        // Start the game
        function startGame() {
            // Get player names and types
            playerData.X.name = player1NameInput.value.trim() || "Player 1";
            playerData.O.name = player2NameInput.value.trim() || "Player 2";
            playerData.X.type = player1TypeSelect.value;
            playerData.O.type = player2TypeSelect.value;
            
            // Update player displays
            player1NameDisplay.textContent = playerData.X.name;
            player2NameDisplay.textContent = playerData.O.name;
            player1AvatarDisplay.textContent = playerData.X.avatar;
            player2AvatarDisplay.textContent = playerData.O.avatar;
            player1TypeDisplay.textContent = playerData.X.type === 'robot' ? 'AI' : 'Human';
            player2TypeDisplay.textContent = playerData.O.type === 'robot' ? 'AI' : 'Human';
            player1ScoreLabel.textContent = playerData.X.name;
            player2ScoreLabel.textContent = playerData.O.name;
            
            // Switch from setup panel to game
            setupPanel.style.display = 'none';
            gameWrapper.style.display = 'flex';
            
            // Reset game state
            resetRound();
            
            // Update player turn display
            updatePlayerTurn();
            
            // Hide install instructions during gameplay
            installInstructions.style.display = 'none';
            
            // If current player is AI, make a move
            if (playerData[currentPlayer].type === 'robot') {
                makeAIMove();
            }
        }
        
        // Initialize the game board
        function initializeBoard() {
            gameBoardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.setAttribute('data-index', i);
                cell.addEventListener('click', () => handleCellClick(i));
                gameBoardElement.appendChild(cell);
            }
        }
        
        // Handle cell click
        function handleCellClick(index) {
            // Check if cell is already taken or game is not active
            if (gameBoard[index] !== '' || !gameActive) return;
            
            // Check if current player is human
            if (playerData[currentPlayer].type !== 'human') return;
            
            // Update game board
            gameBoard[index] = currentPlayer;
            
            // Update UI
            const cellElement = document.querySelector(`.cell[data-index="${index}"]`);
            cellElement.textContent = playerData[currentPlayer].avatar;
            cellElement.style.color = currentPlayer === 'X' ? 
                (document.body.classList.contains('theme-dark') ? '#ff6bcb' : '#ff69b4') : 
                (document.body.classList.contains('theme-dark') ? '#ff2da6' : '#ff1493');
            cellElement.style.animation = 'popIn 0.3s ease-out';
            
            // Play sound if enabled
            if (soundEnabled) {
                playSound('click');
            }
            
            // Check for win or draw
            checkGameResult();
        }
        
        // Play sound
        function playSound(type) {
            // Create audio context for simple sound generation
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different sounds for different events
                if (type === 'click') {
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } else if (type === 'win') {
                    // Victory sound
                    const times = [0, 0.1, 0.2, 0.3];
                    const freqs = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                    
                    times.forEach((time, index) => {
                        oscillator.frequency.setValueAtTime(freqs[index], audioContext.currentTime + time);
                    });
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } else if (type === 'draw') {
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }
            } catch (e) {
                console.log("Audio not supported in this environment");
            }
        }
        
        // Check game result
        function checkGameResult() {
            let roundWon = false;
            let winningCombo = [];
            
            // Check all winning conditions
            for (let i = 0; i < winningConditions.length; i++) {
                const [a, b, c] = winningConditions[i];
                
                if (gameBoard[a] === '' || gameBoard[b] === '' || gameBoard[c] === '') {
                    continue;
                }
                
                if (gameBoard[a] === gameBoard[b] && gameBoard[b] === gameBoard[c]) {
                    roundWon = true;
                    winningCombo = winningConditions[i];
                    break;
                }
            }
            
            // If round is won
            if (roundWon) {
                gameActive = false;
                highlightWinningCells(winningCombo);
                updateScore();
                showWinnerMessage();
                
                // Play win sound if enabled
                if (soundEnabled) {
                    playSound('win');
                }
                return;
            }
            
            // Check for draw
            const roundDraw = !gameBoard.includes('');
            if (roundDraw) {
                gameActive = false;
                showDrawMessage();
                
                // Play draw sound if enabled
                if (soundEnabled) {
                    playSound('draw');
                }
                return;
            }
            
            // Switch player if game continues
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updatePlayerTurn();
            
            // If next player is AI, make a move
            if (playerData[currentPlayer].type === 'robot') {
                makeAIMove();
            }
        }
        
        // Highlight winning cells
        function highlightWinningCells(winningCombo) {
            winningCombo.forEach(index => {
                const cell = document.querySelector(`.cell[data-index="${index}"]`);
                cell.classList.add('winning-cell');
            });
        }
        
        // Update player turn display
        function updatePlayerTurn() {
            const currentPlayerData = playerData[currentPlayer];
            currentPlayerNameElement.textContent = currentPlayerData.name;
            
            // Highlight active player
            document.getElementById('player1Info').classList.remove('active');
            document.getElementById('player2Info').classList.remove('active');
            
            if (currentPlayer === 'X') {
                document.getElementById('player1Info').classList.add('active');
            } else {
                document.getElementById('player2Info').classList.add('active');
            }
            
            // Add cute animation
            playerTurnElement.style.transform = 'scale(1.05)';
            setTimeout(() => {
                playerTurnElement.style.transform = 'scale(1)';
            }, 200);
        }
        
        // Update score
        function updateScore() {
            scores[currentPlayer]++;
            scoreXElement.textContent = scores.X;
            scoreOElement.textContent = scores.O;
            
            // Add animation to updated score
            const updatedScoreElement = currentPlayer === 'X' ? scoreXElement : scoreOElement;
            updatedScoreElement.style.transform = 'scale(1.3)';
            setTimeout(() => {
                updatedScoreElement.style.transform = 'scale(1)';
            }, 300);
        }
        
        // Show winner message
        function showWinnerMessage() {
            const winnerData = playerData[currentPlayer];
            messageTitle.textContent = "We Have a Winner!";
            winnerAvatarElement.textContent = winnerData.avatar;
            messageText.textContent = `${winnerData.name} wins this round!`;
            messageElement.style.display = 'block';
            overlay.style.display = 'block';
        }
        
        // Show draw message
        function showDrawMessage() {
            messageTitle.textContent = "It's a Draw!";
            winnerAvatarElement.textContent = "ü§ù";
            messageText.textContent = "The game ended in a tie. Try again!";
            messageElement.style.display = 'block';
            overlay.style.display = 'block';
        }
        
        // Close message
        function closeMessage() {
            messageElement.style.display = 'none';
            overlay.style.display = 'none';
        }
        
        // Reset round
        function resetRound() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            currentPlayer = 'X';
            
            // Clear board UI
            document.querySelectorAll('.cell').forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('winning-cell');
                cell.style.animation = '';
            });
            
            updatePlayerTurn();
            closeMessage();
            
            // Show install instructions again
            installInstructions.style.display = 'block';
            
            // If current player is AI, make a move
            if (playerData[currentPlayer].type === 'robot') {
                makeAIMove();
            }
        }
        
        // Change players (go back to setup)
        function changePlayers() {
            // Update scores display
            scoreXElement.textContent = '0';
            scoreOElement.textContent = '0';
            
            // Reset scores
            scores = { X: 0, O: 0 };
            
            // Show setup panel, hide game
            setupPanel.style.display = 'block';
            gameWrapper.style.display = 'none';
            
            // Update input fields with current names
            player1NameInput.value = playerData.X.name;
            player2NameInput.value = playerData.O.name;
            player1TypeSelect.value = playerData.X.type;
            player2TypeSelect.value = playerData.O.type;
            
            // Show install instructions
            installInstructions.style.display = 'block';
        }
        
        // Save game state
        function saveGame() {
            const gameState = {
                playerData,
                scores,
                currentPlayer,
                gameBoard,
                gameActive,
                difficulty,
                theme: document.body.classList.contains('theme-pink') ? 'pink' :
                      document.body.classList.contains('theme-blue') ? 'blue' :
                      document.body.classList.contains('theme-purple') ? 'purple' :
                      document.body.classList.contains('theme-green') ? 'green' : 'dark'
            };
            
            localStorage.setItem('ticTacToeSave', JSON.stringify(gameState));
            
            // Show confirmation
            alert('Game saved successfully!');
        }
        
        // Load game state
        function loadGame() {
            const savedState = localStorage.getItem('ticTacToeSave');
            
            if (!savedState) {
                alert('No saved game found!');
                return;
            }
            
            const gameState = JSON.parse(savedState);
            
            // Load game state
            playerData = gameState.playerData;
            scores = gameState.scores;
            currentPlayer = gameState.currentPlayer;
            gameBoard = gameState.gameBoard;
            gameActive = gameState.gameActive;
            difficulty = gameState.difficulty;
            
            // Update UI
            updateUIFromLoadedGame();
            
            // Change theme if different
            changeTheme(gameState.theme);
            
            // Update difficulty buttons
            selectDifficulty(difficulty);
            
            // Show game area
            setupPanel.style.display = 'none';
            gameWrapper.style.display = 'flex';
            
            alert('Game loaded successfully!');
        }
        
        // Update UI from loaded game
        function updateUIFromLoadedGame() {
            // Update player displays
            player1NameDisplay.textContent = playerData.X.name;
            player2NameDisplay.textContent = playerData.O.name;
            player1AvatarDisplay.textContent = playerData.X.avatar;
            player2AvatarDisplay.textContent = playerData.O.avatar;
            player1TypeDisplay.textContent = playerData.X.type === 'robot' ? 'AI' : 'Human';
            player2TypeDisplay.textContent = playerData.O.type === 'robot' ? 'AI' : 'Human';
            player1ScoreLabel.textContent = playerData.X.name;
            player2ScoreLabel.textContent = playerData.O.name;
            
            // Update scores
            scoreXElement.textContent = scores.X;
            scoreOElement.textContent = scores.O;
            
            // Update board
            document.querySelectorAll('.cell').forEach((cell, index) => {
                cell.textContent = '';
                cell.classList.remove('winning-cell');
                cell.style.animation = '';
                
                if (gameBoard[index] !== '') {
                    cell.textContent = playerData[gameBoard[index]].avatar;
                    cell.style.color = gameBoard[index] === 'X' ? 
                        (document.body.classList.contains('theme-dark') ? '#ff6bcb' : '#ff69b4') : 
                        (document.body.classList.contains('theme-dark') ? '#ff2da6' : '#ff1493');
                }
            });
            
            // Update player turn
            updatePlayerTurn();
            
            // Hide install instructions
            installInstructions.style.display = 'none';
            
            // If current player is AI and game is active, make a move
            if (gameActive && playerData[currentPlayer].type === 'robot') {
                makeAIMove();
            }
        }
        
        // Toggle sound
        function toggleSound() {
            soundEnabled = !soundEnabled;
            soundToggle.innerHTML = soundEnabled ? 
                '<i class="fas fa-volume-up"></i> Sound On' : 
                '<i class="fas fa-volume-mute"></i> Sound Off';
            
            // Save preference
            localStorage.setItem('ticTacToeSound', soundEnabled);
        }
        
        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show install button
            installButton.style.display = 'block';
        });
        
        // Handle install button click
        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
                installButton.style.display = 'none';
            } else {
                console.log('User dismissed the install prompt');
            }
            
            // Clear the saved prompt
            deferredPrompt = null;
        });
        
        // Check if app is already installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            installButton.style.display = 'none';
            deferredPrompt = null;
        });
        
        // Add random decorations
        function addDecorations() {
            // Remove any existing decorations
            document.querySelectorAll('.decoration').forEach(decoration => {
                decoration.remove();
            });
            
            for (let i = 0; i < 15; i++) {
                const decoration = document.createElement('div');
                decoration.classList.add('decoration');
                decoration.textContent = availableAvatars[Math.floor(Math.random() * availableAvatars.length)];
                
                // Random position
                decoration.style.left = `${Math.random() * 100}%`;
                decoration.style.top = `${Math.random() * 100}%`;
                
                // Random size
                const size = Math.random() * 30 + 20;
                decoration.style.fontSize = `${size}px`;
                
                // Random rotation
                const rotation = Math.random() * 360;
                decoration.style.transform = `rotate(${rotation}deg)`;
                
                // Random opacity
                decoration.style.opacity = Math.random() * 0.5 + 0.3;
                
                document.body.appendChild(decoration);
            }
        }
        
        // Event listeners
        startGameBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetRound);
        newGameBtn.addEventListener('click', changePlayers);
        closeMessageBtn.addEventListener('click', closeMessage);
        saveGameBtn.addEventListener('click', saveGame);
        loadGameBtn.addEventListener('click', loadGame);
        soundToggle.addEventListener('click', toggleSound);
        
        // Theme selection
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                changeTheme(option.dataset.theme);
            });
        });
        
        // Difficulty selection
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectDifficulty(button.dataset.difficulty);
            });
        });
        
        // Initialize the game
        window.addEventListener('DOMContentLoaded', () => {
            initializeAvatarSelection();
            initializeBoard();
            addDecorations();
            
            // Load saved preferences
            const savedTheme = localStorage.getItem('ticTacToeTheme');
            if (savedTheme) {
                changeTheme(savedTheme);
            }
            
            const savedDifficulty = localStorage.getItem('ticTacToeDifficulty');
            if (savedDifficulty) {
                selectDifficulty(savedDifficulty);
            }
            
            const savedSound = localStorage.getItem('ticTacToeSound');
            if (savedSound !== null) {
                soundEnabled = savedSound === 'true';
                soundToggle.innerHTML = soundEnabled ? 
                    '<i class="fas fa-volume-up"></i> Sound On' : 
                    '<i class="fas fa-volume-mute"></i> Sound Off';
            }
        });
        
        // Allow Enter key to start game from name inputs
        player1NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startGame();
        });
        
        player2NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startGame();
        });
        
        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('SW registered: ', registration);
                }).catch(registrationError => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }
    </script>
</body>
</html>
